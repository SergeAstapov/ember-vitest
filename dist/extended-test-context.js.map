{"version":3,"file":"extended-test-context.js","sources":["../src/extended-test-context.ts"],"sourcesContent":["import {\n  setApplication,\n  resumeTest,\n  pauseTest,\n  type TestContext,\n} from \"@ember/test-helpers\";\n\n// https://vitest.dev/guide/test-context.html#extend-test-context\nimport { test as baseTest } from \"vitest\";\nimport {\n  setupContext,\n  teardownContext,\n  setupRenderingContext,\n  setupApplicationContext,\n} from \"@ember/test-helpers\";\n\nimport Application from \"ember-strict-application-resolver\";\n\nimport type EmberApplication from \"@ember/application\";\nimport type { Owner } from \"@ember/test-helpers/build-owner\";\n\nglobalThis.resumeTest = resumeTest;\n\nclass App extends Application {\n  modules = {};\n}\n\nconst waitForSettled = true;\nconst teardownContextOptions = { waitForSettled };\n\ntype ExtendedTestContext = {\n  app: typeof EmberApplication;\n  element: HTMLElement;\n  context: TestContext;\n  env: {\n    owner: Owner;\n    element: HTMLElement;\n    pauseTest: () => Promise<void>;\n  };\n};\n\nexport const test = baseTest.extend<ExtendedTestContext>({\n  app: ({}, use) => use(App),\n  element: ({}, use) => use(document.createElement(\"div\")),\n  context: ({}, use) => use({} as TestContext),\n  env: [\n    async (\n      {\n        app,\n        element,\n        context,\n      }: {\n        app: typeof EmberApplication;\n        element: HTMLElement;\n        context: TestContext;\n      },\n      use,\n    ) => {\n      document.body.append(element);\n\n      setApplication(app.create({ autoboot: false, rootElement: element }));\n      await setupContext(context);\n\n      await use({\n        owner: context.owner,\n        element,\n        pauseTest,\n      });\n\n      await teardownContext(context, teardownContextOptions);\n      element.remove();\n    },\n    { auto: true },\n  ],\n});\n\nexport const renderingTest = baseTest.extend<ExtendedTestContext>({\n  app: ({}, use) => use(App),\n  element: ({}, use) => use(document.createElement(\"div\")),\n  context: ({}, use) => use({} as TestContext),\n  env: [\n    async (\n      {\n        app,\n        element,\n        context,\n      }: {\n        app: typeof EmberApplication;\n        element: HTMLElement;\n        context: TestContext;\n      },\n      use,\n    ) => {\n      document.body.append(element);\n\n      setApplication(app.create({ autoboot: false, rootElement: element }));\n      await setupContext(context);\n      await setupRenderingContext(context);\n\n      await use({\n        owner: context.owner,\n        element,\n        pauseTest,\n      });\n\n      await teardownContext(context, teardownContextOptions);\n      element.remove();\n    },\n    { auto: true },\n  ],\n});\n\nexport const applicationTest = baseTest.extend<ExtendedTestContext>({\n  app: ({}, use) => use(App),\n  element: ({}, use) => use(document.createElement(\"div\")),\n  context: ({}, use) => use({} as TestContext),\n  env: [\n    async (\n      {\n        app,\n        element,\n        context,\n      }: {\n        app: typeof EmberApplication;\n        element: HTMLElement;\n        context: TestContext;\n      },\n      use,\n    ) => {\n      document.body.append(element);\n\n      console.log(app);\n\n      setApplication(app.create({ autoboot: false, rootElement: element }));\n      await setupContext(context);\n      await setupApplicationContext(context);\n\n      await use({\n        owner: context.owner,\n        element,\n        pauseTest,\n      });\n\n      await teardownContext(context, teardownContextOptions);\n      element.remove();\n    },\n    { auto: true },\n  ],\n});\n"],"names":["globalThis","resumeTest","App","Application","modules","waitForSettled","teardownContextOptions","test","baseTest","extend","app","use","element","document","createElement","context","env","body","append","setApplication","create","autoboot","rootElement","setupContext","owner","pauseTest","teardownContext","remove","auto","renderingTest","setupRenderingContext","applicationTest","console","log","setupApplicationContext"],"mappings":"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"}
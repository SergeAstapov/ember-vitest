{"version":3,"file":"manual.js","sources":["../src/manual.ts"],"sourcesContent":["import { getOwner } from \"@ember/owner\";\nimport { settled, click, type TestContext } from \"@ember/test-helpers\";\nimport {\n  setupContext as emberSetupContext,\n  teardownContext,\n  setApplication,\n  type Target,\n} from \"@ember/test-helpers\";\nimport { renderComponent } from \"@ember/renderer\";\nimport { create, createApp } from \"./create-app.ts\";\n\nimport type EmberApplication from \"@ember/application\";\nimport type Component from \"@glimmer/component\";\nimport type TOC from \"@ember/component/template-only\";\n\nexport function setupContext() {\n  let element = document.createElement(\"div\");\n  document.body.append(element);\n  const app = createApp(element);\n\n  return {\n    element,\n    get owner() {\n      return getOwner(app);\n    },\n    async [Symbol.asyncDispose]() {\n      app.destroy();\n      await settled();\n      element.remove();\n    },\n  };\n}\n\nexport async function setupRenderingContext(app: typeof EmberApplication) {\n  let element = document.createElement(\"div\");\n  document.body.append(element);\n\n  let renders: Array<ReturnType<typeof renderComponent>> = [];\n  let ctx = {} as TestContext;\n  let created = create(app, element);\n\n  setApplication(created);\n\n  await emberSetupContext(ctx);\n\n  // Overloads that match Element.querySelector:\n  function find<K extends keyof (HTMLElementTagNameMap | SVGElementTagNameMap)>(\n    selector: K,\n  ): HTMLElementTagNameMap[K] | SVGElementTagNameMap[K] | null;\n  function find<K extends keyof HTMLElementTagNameMap>(\n    selector: K,\n  ): HTMLElementTagNameMap[K] | null;\n  function find<K extends keyof SVGElementTagNameMap>(\n    selector: K,\n  ): SVGElementTagNameMap[K] | null;\n  function find<E extends Element = Element>(selector: string): E | null;\n  function find(selector: string) {\n    return element.querySelector(selector);\n  }\n\n  // Overloads that match Element.querySelectorAll:\n  function findAll<K extends keyof HTMLElementTagNameMap>(\n    selector: K,\n  ): NodeListOf<HTMLElementTagNameMap[K]>;\n  function findAll<K extends keyof SVGElementTagNameMap>(\n    selector: K,\n  ): NodeListOf<SVGElementTagNameMap[K]>;\n  function findAll<K extends keyof HTMLElementDeprecatedTagNameMap>(\n    selector: K,\n  ): NodeListOf<HTMLElementDeprecatedTagNameMap[K]>;\n  function findAll<E extends Element = Element>(\n    selector: string,\n  ): NodeListOf<E>;\n  function findAll(selector: string) {\n    return element.querySelectorAll(selector);\n  }\n\n  return {\n    element,\n    get owner() {\n      return ctx.owner;\n    },\n    find,\n    findAll,\n    click(target: Parameters<typeof click>[0]) {\n      return click(target);\n    },\n    async render(\n      component: (new (...args: unknown[]) => Component) | typeof TOC,\n    ) {\n      let result = renderComponent(component, {\n        into: element,\n        owner: ctx.owner,\n      });\n\n      renders.push(result);\n      await settled();\n    },\n    async [Symbol.dispose]() {\n      renders.forEach((r) => r.destroy());\n      await teardownContext(ctx);\n      element.remove();\n    },\n    async [Symbol.asyncDispose]() {\n      renders.forEach((r) => r.destroy());\n      await settled();\n      await teardownContext(ctx);\n      await settled();\n      element.remove();\n    },\n  };\n}\n"],"names":["setupContext","element","document","createElement","body","append","app","createApp","owner","getOwner","Symbol","asyncDispose","destroy","settled","remove","setupRenderingContext","renders","ctx","created","create","setApplication","emberSetupContext","find","selector","querySelector","findAll","querySelectorAll","click","target","render","component","result","renderComponent","into","push","dispose","forEach","r","teardownContext"],"mappings":";;;;;AAeO,SAASA,YAAYA,GAAG;AAC7B,EAAA,IAAIC,OAAO,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;AAC3CD,EAAAA,QAAQ,CAACE,IAAI,CAACC,MAAM,CAACJ,OAAO,CAAC;AAC7B,EAAA,MAAMK,GAAG,GAAGC,SAAS,CAACN,OAAO,CAAC;EAE9B,OAAO;IACLA,OAAO;IACP,IAAIO,KAAKA,GAAG;MACV,OAAOC,QAAQ,CAACH,GAAG,CAAC;IACtB,CAAC;IACD,OAAOI,MAAM,CAACC,YAAY,CAAA,GAAI;MAC5BL,GAAG,CAACM,OAAO,EAAE;MACb,MAAMC,OAAO,EAAE;MACfZ,OAAO,CAACa,MAAM,EAAE;AAClB,IAAA;GACD;AACH;AAEO,eAAeC,qBAAqBA,CAACT,GAA4B,EAAE;AACxE,EAAA,IAAIL,OAAO,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;AAC3CD,EAAAA,QAAQ,CAACE,IAAI,CAACC,MAAM,CAACJ,OAAO,CAAC;EAE7B,IAAIe,OAAkD,GAAG,EAAE;EAC3D,IAAIC,GAAG,GAAG,EAAiB;AAC3B,EAAA,IAAIC,OAAO,GAAGC,MAAM,CAACb,GAAG,EAAEL,OAAO,CAAC;EAElCmB,cAAc,CAACF,OAAO,CAAC;EAEvB,MAAMG,cAAiB,CAACJ,GAAG,CAAC;;AAE5B;;EAWA,SAASK,IAAIA,CAACC,QAAgB,EAAE;AAC9B,IAAA,OAAOtB,OAAO,CAACuB,aAAa,CAACD,QAAQ,CAAC;AACxC,EAAA;;AAEA;;EAaA,SAASE,OAAOA,CAACF,QAAgB,EAAE;AACjC,IAAA,OAAOtB,OAAO,CAACyB,gBAAgB,CAACH,QAAQ,CAAC;AAC3C,EAAA;EAEA,OAAO;IACLtB,OAAO;IACP,IAAIO,KAAKA,GAAG;MACV,OAAOS,GAAG,CAACT,KAAK;IAClB,CAAC;IACDc,IAAI;IACJG,OAAO;IACPE,KAAKA,CAACC,MAAmC,EAAE;MACzC,OAAOD,KAAK,CAACC,MAAM,CAAC;IACtB,CAAC;IACD,MAAMC,MAAMA,CACVC,SAA+D,EAC/D;AACA,MAAA,IAAIC,MAAM,GAAGC,eAAe,CAACF,SAAS,EAAE;AACtCG,QAAAA,IAAI,EAAEhC,OAAO;QACbO,KAAK,EAAES,GAAG,CAACT;AACb,OAAC,CAAC;AAEFQ,MAAAA,OAAO,CAACkB,IAAI,CAACH,MAAM,CAAC;MACpB,MAAMlB,OAAO,EAAE;IACjB,CAAC;IACD,OAAOH,MAAM,CAACyB,OAAO,CAAA,GAAI;MACvBnB,OAAO,CAACoB,OAAO,CAAEC,CAAC,IAAKA,CAAC,CAACzB,OAAO,EAAE,CAAC;MACnC,MAAM0B,eAAe,CAACrB,GAAG,CAAC;MAC1BhB,OAAO,CAACa,MAAM,EAAE;IAClB,CAAC;IACD,OAAOJ,MAAM,CAACC,YAAY,CAAA,GAAI;MAC5BK,OAAO,CAACoB,OAAO,CAAEC,CAAC,IAAKA,CAAC,CAACzB,OAAO,EAAE,CAAC;MACnC,MAAMC,OAAO,EAAE;MACf,MAAMyB,eAAe,CAACrB,GAAG,CAAC;MAC1B,MAAMJ,OAAO,EAAE;MACfZ,OAAO,CAACa,MAAM,EAAE;AAClB,IAAA;GACD;AACH;;;;"}